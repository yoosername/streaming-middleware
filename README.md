# streaming-middleware

[![Build Status](https://travis-ci.org/yoosername/streaming-middleware.svg?branch=master)](https://travis-ci.org/yoosername/streaming-middleware)
[![Coverage Status](https://coveralls.io/repos/github/yoosername/streaming-middleware/badge.svg?branch=master)](https://coveralls.io/github/yoosername/streaming-middleware?branch=master)

> Compose a chain of Transform Streams with Express-like middleware.

## Installation

```bash
npm install streaming-middleware
```

## Usage

An instance of StreamingMiddleware is a type of Duplex Stream which internally writes data to and reads data from a chain of Transform streams that are piped through dynamically in the order you add them.

```javascript
var StreamingMiddleware = require("streaming-middleware");
var app = StreamingMiddleware();

app
  .use(function Uppercase(chunk, enc, next){
    next(null, chunk.toString().toUpperCase() );
  })
  .use(function Reverse(chunk, enc, next){
    next(null, chunk.toString().split("").reverse().join("").trim("") + "\n" );
  })

process.stdin.pipe(app.stream()).pipe(process.stdout);
```

```bash
echo "pickle rick" | node app.js      // # KCIR ELKCIP
```

## Test

```bash
npm test

# or
npm install -g mocha
mocha test/**/*spec.js --reporter spec
# or
mocha test/**/*spec.js --reporter=nyan
```

## Test Documentation

The [test documentation](https://github.com/yoosername/streaming-middleware/blob/master/test/tests.md) was generated with Mocha’s “doc” reporter, and directly reflects the test suite.

## Coverage

```bash
npm run coverage
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### StreamingMiddleware

Transform stream builder

#### use

Add a Transform Function to the stack

**Parameters**

-   `fn` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** An instanceof {Transform} or a plain Function with 3 args

**Examples**

```javascript
Simple use

 var app = StreamingMiddleware();
 app.use(function Uppercase(chunk, enc, next){
   next(null, chunk.toString().toUpperCase() );
 })
```

```javascript
Chaining

 var app = StreamingMiddleware();
 app
   .use(function Uppercase(chunk, enc, next){
     next(null, chunk.toString().toUpperCase() );
   })
   .use(function Reverse(chunk, enc, next){
     next(null, chunk.toString().split("").reverse().join("").trim("") + "\n" );
   })
```

Returns **[StreamingMiddleware](#streamingmiddleware)** 

#### stream

Return a Duplex stream built by connecting all the Transform streams which were added via StreamingMiddleware.use()

**Parameters**

-   `options` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** options passed to each Transform e.g. "objectMode"

**Examples**

```javascript
Stream of 2 Transforms in non object mode

 var app = StreamingMiddleware();
 app
   .use(function Uppercase(chunk, enc, next){
     next(null, chunk.toString().toUpperCase() );
   })
   .use(function Uppercase(chunk, enc, next){
     next(null, chunk.toString().split("").reverse().join("").trim("") + "\n" );
   })
 process.stdin.pipe(app.stream()).pipe(process.stdout);
```

Returns **DuplexStream** 

## More Examples

See [more examples in the Example folder](https://github.com/yoosername/streaming-middleware/blob/master/examples/EXAMPLES.md)

## Why

- Experiment creating an easily extendable CLI for processing streamed data
- Experiment using a test driven approach
- Experiment using various Tools e.g. travis-ci, jshint, instanbul, autodoc etc
